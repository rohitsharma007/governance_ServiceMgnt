<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compliance Evidence Validator - MVP Demo</title>
  <style>
    body{font-family:Inter,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#f6f7fb;margin:0}
    header{background:#fff;border-bottom:1px solid #e0e0e0;padding:14px 18px;display:flex;gap:10px;align-items:center}
    h1{font-size:16px;margin:0;font-weight:600}
    main{max-width:1000px;margin:20px auto;padding:0 16px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    textarea{width:100%;min-height:220px;padding:12px;border-radius:8px;border:1px solid #d9d9df;background:#fff;font-size:13px}
    .card{background:#fff;border:1px solid #e5e6eb;border-radius:10px;padding:14px}
    .btn{border:none;border-radius:8px;padding:10px 14px;background:#4262ff;color:#fff;cursor:pointer;font-size:13px}
    .btn.secondary{background:#f0f1f3;color:#1a1a1a}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border-bottom:1px solid #eee;padding:8px;text-align:left;font-size:12px}
    th{background:#fafafa}
    .status-ok{color:#0a7f3f;font-weight:600}
    .status-partial{color:#b26c00;font-weight:600}
    .status-missing{color:#c02e2e;font-weight:600}
    .small{font-size:12px;color:#666}
    footer{margin-top:24px;color:#666;font-size:12px}
  </style>
</head>
<body>
  <header>
    <h1>Compliance Evidence Validator - MVP Demo</h1>
    <button class="btn secondary" onclick="loadSample()">Load Sample Text</button>
    <button class="btn" onclick="runValidation()">Run Validation</button>
  </header>
  <main>
    <div class="grid">
      <div class="card">
        <h3 class="small">Paste document text (from Test Plan/Strategy/Review Form)</h3>
        <textarea id="docText" placeholder="Paste relevant sections here..."></textarea>
      </div>
      <div class="card">
        <h3 class="small">Controls → Evidence Mapping (from mapping.json)</h3>
        <div id="mappingInfo" class="small">Loading mapping...</div>
      </div>
    </div>
    <div class="card" style="margin-top:16px">
      <h3 class="small">Results</h3>
      <div id="results"></div>
    </div>
    <footer>
      MVP logic: simple keyword and section matching against mapping.json. In production, integrate file conversion + section extraction via Graph/Syntex/Document Intelligence and post results to SharePoint/Teams.
    </footer>
  </main>
  <script>
    let mapping = null;
    async function loadMapping(){
      const res = await fetch('mapping.json');
      mapping = await res.json();
      const html = [`Project: ${mapping.projectId}`, `Change: ${mapping.changeId}`, '', ...mapping.controls.map(c=>`• ${c.id} — ${c.name}`)].join('<br>');
      document.getElementById('mappingInfo').innerHTML = html;
    }
    function loadSample(){
      const sample = `SDLC Governance and Quality Management review has been completed using the Governance Review Form.\n\nTest Plan: CASH August Release Test Plan V0.1.1 includes Testing Scope, Acceptance Criteria, Definition of Done for Testing and Testing Estimates. Change Impact Analysis is documented in the Impact Analysis Template.\n\nTest Strategy slides 12 to 24 describe the Testing Scope.`;
      document.getElementById('docText').value = sample;
    }
    function normalize(t){return (t||'').toLowerCase();}
    function runValidation(){
      if(!mapping){alert('Mapping not loaded yet');return}
      const text = normalize(document.getElementById('docText').value);
      const rows = [];
      mapping.controls.forEach(ctrl=>{
        // evidence checks
        let evidenceFound = 0; const evidenceDetails=[];
        ctrl.requiredEvidence.forEach(ev=>{
          const found = ev.keywords.some(k=> text.includes(normalize(k)));
          evidenceFound += found?1:0;
          evidenceDetails.push({name: ev.name, found});
        });
        // control elements
        let elementsFound = 0; const elementDetails=[];
        (ctrl.controlElements||[]).forEach(el=>{
          const found = text.includes(normalize(el));
          elementsFound += found?1:0;
          elementDetails.push({name: el, found});
        });
        const evRatio = ctrl.requiredEvidence.length? evidenceFound/ctrl.requiredEvidence.length : 1;
        const elRatio = ctrl.controlElements && ctrl.controlElements.length? elementsFound/ctrl.controlElements.length : 1;
        const overall = (evRatio>0.99 && elRatio>0.99)? 'Fully Compliant' : ((evRatio>0 && elRatio>0)? 'Partially Compliant' : 'Missing Evidence');
        rows.push({ctrl, evidenceDetails, elementDetails, overall});
      });
      // render
      let html = '<table><thead><tr><th>Control</th><th>Evidence</th><th>Elements</th><th>Status</th></tr></thead><tbody>';
      rows.forEach(r=>{
        const evText = r.evidenceDetails.map(d=>`${d.found?'✅':'❌'} ${d.name}`).join('<br>');
        const elText = r.elementDetails.map(d=>`${d.found?'✅':'❌'} ${d.name}`).join('<br>');
        const cls = r.overall==='Fully Compliant'? 'status-ok' : (r.overall==='Partially Compliant'? 'status-partial' : 'status-missing');
        html += `<tr><td><strong>${r.ctrl.id}</strong><br>${r.ctrl.name}</td><td>${evText}</td><td>${elText}</td><td class="${cls}">${r.overall}</td></tr>`;
      });
      html += '</tbody></table>'; 
      document.getElementById('results').innerHTML = html;
    }
    loadMapping();
  </script>
</body>
</html>